<!DOCTYPE html>
<html>
<head>
    <title>Facial Recognition</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <h1>Facial Recognition</h1>
    <video id="video" width="640" height="480" autoplay></video>
    <button id="capture">Capture</button>
    <div id="result"></div>

    <script>
        // Access the webcam feed
        navigator.mediaDevices.getUserMedia({ video: true })
            .then(function (stream) {
                var video = document.getElementById('video');
                video.srcObject = stream;
            })
            .catch(function (err) {
                console.log("An error occurred: " + err);
            });

        // Capture image from webcam feed
        document.getElementById('capture').addEventListener('click', function () {
            var video = document.getElementById('video');
            var canvas = document.createElement('canvas');
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            canvas.getContext('2d').drawImage(video, 0, 0);
            canvas.toBlob(function (blob) {
                var formData = new FormData();
                formData.append('image', blob, 'image.jpg');

                // Send captured image to the server for facial recognition
                $.ajax({
                    type: "POST",
                    url: "{{ ec2_url }}/process_image",
                    data: formData,
                    processData: false,
                    contentType: false,
                    success: function (response) {
                        if (response.status === 'recognized') {
                            $('#result').text('Person recognized: ' + response.name);
                        } else {
                            $('#result').text('Person not recognized');
                        }
                    }
                });
            }, 'image/jpeg');
        });
    </script>
</body>
</html>